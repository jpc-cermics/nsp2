SHELL = /bin/sh

include ../Path.incl
include ../Version.incl
include ../Makefile.incl

IP = $(SCIDIR)/Path.incl
IV = $(SCIDIR)/Version.incl

SBIN = $(SCIDIR)/bin
UTIL = $(SCIDIR)/util

XXBPROGRAMS = $(SBIN)/Blatexpr $(SBIN)/Blatexpr2 \
	$(SBIN)/Blatexprs $(SBIN)/Blpr $(SBIN)/BEpsf \
	$(UTIL)/Blatdoc $(UTIL)/Blatdocs

PROGRAMS = $(SBIN)/nsp nsp-inst Path.incl @BLPR_SCRIPTS@ \
	$(SBIN)/nsplibtool nsplibtool-inst

all:: $(PROGRAMS)

CYGDRIVE= -e "s+/cygdrive/\([a-zA-Z]*\)/+\1:/+g" 
SED_CYGDRIVE= @SED_CYGDRIVE@

# script for local use 

$(SBIN)/nsp: @SCILABSCRIPT@ $(IP) $(IV)
	@$(RM) $(SBIN)/nsp
	@sed -e "s+SCILAB_DIRECTORY+$(SCIDIR)+" $(SED_CYGDRIVE) \
	-e "s+SCILAB_VERSION+$(SCIVERSION)+" \
	-e "s+SCILABGS+@SCILAB_GS@+" @SCILABSCRIPT@ > nsp;
	@cp nsp $(SBIN)
	@chmod 775 $(SBIN)/nsp
	@$(RM) nsp
	@echo $(SBIN)/nsp created

# script which uses prefix 

nsp-inst: @SCILABSCRIPT@ $(IP) $(IV) ../Makefile.incl
	@$(RM) nsp-inst
	@sed -e "s+SCILAB_DIRECTORY+$(prefix)/lib/nsp+" $(SED_CYGDRIVE) \
	-e "s+SCILAB_VERSION+$(SCIVERSION)+" \
	-e "s+SCILABGS+@SCILAB_GS@+" @SCILABSCRIPT@ > nsp-inst;

$(SBIN)/nsplibtool: nsplibtool $(IP) $(IV)
	@$(RM) $@
	@sed 	-e "s+SCILAB_DIRECTORY+$(SCIDIR)+g" \
		-e "s+SCILABGS+@SCILAB_GS@+" nsplibtool > $@ 
	@chmod 775 $@
	@echo $@ created

# script which uses prefix 

nsplibtool-inst: nsplibtool $(IP) $(IV)
	@$(RM) $@
	@sed -e "s+SCILAB_DIRECTORY+$(prefix)/lib/nsp+g" \
		-e "s+SCILABGS+@SCILAB_GS@+" nsplibtool > $@ 	

Path.incl: $(IP) $(IV) ../Makefile.incl
	@$(RM) Path.incl
	@echo "SCIDIR=$(prefix)/lib/nsp" > $@ 

$(SBIN)/Blatexpr: Blatexpr.g $(IP)
	@$(RM) $(SBIN)/Blatexpr
	@sed -e "s+SCILAB_DIRECTORY+$(SCIDIR)+" Blatexpr.g > Blatexpr;
	@cp Blatexpr $(SBIN)
	@chmod 775 $(SBIN)/Blatexpr
	@$(RM) Blatexpr
	@echo $(SBIN)/Blatexpr created

$(SBIN)/BEpsf: BEpsf.g $(IP)
	@$(RM) $(SBIN)/BEpsf
	@sed -e "s+SCILAB_DIRECTORY+$(SCIDIR)+" BEpsf.g > BEpsf;
	@cp BEpsf $(SBIN)
	@chmod 775 $(SBIN)/BEpsf
	@$(RM) BEpsf
	@echo $(SBIN)/BEpsf created

$(SBIN)/Blatexpr2: Blatexpr2.g $(IP)
	@$(RM) $(SBIN)/Blatexpr2
	@sed -e "s+SCILAB_DIRECTORY+$(SCIDIR)+" Blatexpr2.g > Blatexpr2;
	@cp Blatexpr2 $(SBIN)
	@chmod 775 $(SBIN)/Blatexpr2
	@$(RM) Blatexpr2
	@echo $(SBIN)/Blatexpr2 created

$(SBIN)/Blatexprs: Blatexprs.g $(IP)
	@$(RM) $(SBIN)/Blatexprs
	@sed -e "s+SCILAB_DIRECTORY+$(SCIDIR)+" Blatexprs.g > Blatexprs;
	@cp Blatexprs $(SBIN)
	@chmod 775 $(SBIN)/Blatexprs
	@$(RM) Blatexprs
	@echo $(SBIN)/Blatexprs created

$(SBIN)/Blpr: Blpr.g $(IP)
	@$(RM) $(SBIN)/Blpr
	@sed -e "s+SCILAB_DIRECTORY+$(SCIDIR)+" Blpr.g > Blpr;
	@cp Blpr $(SBIN)
	@chmod 775 $(SBIN)/Blpr
	@$(RM) Blpr
	@echo $(SBIN)/Blpr created

$(UTIL)/Blatdoc: Blatdoc.g $(IP)
	@$(RM) $(UTIL)/Blatdoc
	@sed -e "s+SCILAB_DIRECTORY+$(SCIDIR)+" Blatdoc.g > Blatdoc;
	@cp Blatdoc $(UTIL)
	@chmod 775 $(UTIL)/Blatdoc
	@$(RM) Blatdoc
	@echo $(UTIL)/Blatdoc created

$(UTIL)/Blatdocs: Blatdocs.g $(IP)
	@$(RM) $(UTIL)/Blatdocs
	@sed -e "s+SCILAB_DIRECTORY+$(SCIDIR)+" Blatdocs.g > Blatdocs;
	@cp Blatdocs $(UTIL)
	@chmod 775 $(UTIL)/Blatdocs
	@$(RM) Blatdocs
	@echo $(UTIL)/Blatdocs created

distclean::
	@$(RM) $(PROGRAMS) 
