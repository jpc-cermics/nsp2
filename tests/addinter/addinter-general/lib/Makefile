#/* -*- Mode: Makefile -*- */
# Copyright (C) 2005-2016 Jean-Philippe Chancelier Enpc/Cermics
# This file is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License.

SHELL=/bin/sh

SCIDIR=../../../../

include $(SCIDIR)Makefile.incl


# 1/ Makelib is generated by the builder.sce file
# when Makelib exists we use it and when it
# does not exists we create it with the builder.sce file
# 2/ in the builder.sce file we use the option compile = %f
# which means that the builder will not try to compile the code
# the compilation is done by the makefile which can use the -j option

NSP=$(SCIDIR)bin/nsp

all	::
	@if test -f Makelib; then \
		$(MAKE) -s -f Makelib $(MFLAGS); \
	else ( echo "running builder to create Makelib" && \
		$(NSP) -ns -nw -e "exec('builder.sce');quit" -errcatch && \
		$(MAKE) -s -f Makelib $(MFLAGS)); \
	fi

job	: 
	make -f Makelib

tests	: all
	make -f Makelib tests 

clean	::
	@$(RM) -f -r *.o *.lo *.la *.so *.dll *.sl *.a *.dia .job.sce so_locations
	@$(RM) -f -r .libs libmex.c 

distclean:: clean 
	@$(RM) -f *.dia Makelib loader.sce

message:
	@echo "------------------------------------------";
	@echo "At Scilab prompt, enter:";
	@echo "-->exec loader.sce";
	@echo "------------------------------------------";



